import streamlit as st
import pandas as pd
import matplotlib.pyplot as plt
import folium
from streamlit_folium import st_folium
from PIL import Image

#st.set_page_config(layout="wide")

st.title("ğŸ“ ì§„ì£¼ì‹œ ë²”ì£„")

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 1. ì£¼ì œ ì„ ì • ì´ìœ 
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€        
st.subheader("1ï¸âƒ£ ì£¼ì œ ì„ ì • ë°°ê²½")

st.markdown("""
-ì•„ë˜ì˜ ê·¸ë˜í”„ëŠ” **ê²½ìƒë‚¨ë„ ë‚´ì—ì„œ ì§€ì—­ë³„ ë²”ì£„ ì§€ìˆ˜ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.
""")
img1 = Image.open("/workspaces/DS_TP/data/crime_region.png")
img1_1 = img1.resize((400, 350))  # (width, height)
st.image(img1_1, caption="ê²½ìƒë‚¨ë„ì˜ ì§€ì—­ë³„ ë²”ì£„ì§€ìˆ˜")

st.markdown("""
- ë˜ ë‹¤ë¥¸ ìë£ŒëŠ” **ì§„ì£¼ì‹œì˜ ë²”ì£„ê°€ ì—°ë„ë³„ë¡œ ì¦ê°€í•˜ê³  ìˆëŠ” ì¶”ì„¸**ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.
""")
img2 = Image.open("/workspaces/DS_TP/data/crime_year.png")
img2_1 = img2.resize((500,240))
st.image(img2_1, caption="ì—°ë„ë³„ ì§„ì£¼ì‹œ ë²”ì£„ ì§€ìˆ˜") 

st.markdown("""
ğŸ‘‰ ì´ëŸ¬í•œ ë°°ê²½ ì†ì—ì„œ, ìš°ë¦¬ëŠ” ì§„ì£¼ì‹œì˜ ë²”ì£„ì˜ íŠ¹ì„±ì„ íŒŒì•…í•˜ê³  ì‹œê°„ì , í™˜ê²½ì  ìš”ì¸ì„ ë¶„ì„í•˜ì—¬ ëŒ€ì±…ì„ ì œì•ˆí•˜ê³  ì‹¶ìŠµë‹ˆë‹¤.
""")

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 2. ì‹œê°„ì , í™˜ê²½ì  ìš”ì¸ê³¼ ì´ë¡ ì  ë°°ê²½
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
st.subheader("2ï¸âƒ£ í™˜ê²½ì  ìš”ì¸ê³¼ ì´ë¡ ì  ë°°ê²½")

st.markdown("""
- êµ­ë‚´ ì—°êµ¬ì— ë”°ë¥´ë©´, ë²”ì£„ ë°œìƒì—ëŠ” ì‹œê°„ì , í™˜ê²½ì  ìš”ì¸ì´ í° ì˜í–¥ì„ ë¯¸ì¹œë‹¤ëŠ” ì—°êµ¬ ë‚´ìš©ì´ ìˆìŠµë‹ˆë‹¤.
- ëŒ€í‘œì ì¸ ê²ƒì´ CPTED ì´ë¡ ì…ë‹ˆë‹¤.
- CPTEDì´ë¡ (ë²”ì£„ì˜ˆë°©ì´ë¡ )ì€ ì‚¬ëŒê³¼ ì‹œê°„, í™˜ê²½ì  ìš”ì¸ì´ ë²”ì£„ ë°œìƒì— í° ì˜í–¥ì„ ë¼ì¹œë‹¤ëŠ” ì´ë¡ ì…ë‹ˆë‹¤.
- ì €í¬ëŠ” ê·¸ ì¤‘ì—ì„œ ì‹œê°„ì  ìš”ì¸ê³¼ í™˜ê²½ì  ìš”ì¸ì— ì¤‘ì ì„ ë‘ê³  í”„ë¡œì íŠ¸ë¥¼ ì§„í–‰í•˜ê² ìŠµë‹ˆë‹¤. 
            
[ğŸ‘‰ ìƒí™œì•ˆì „ì§€ë„ ë°”ë¡œê°€ê¸°](https://www.safemap.go.kr/)<br>
[ğŸ‘‰ CPTED ê°œë… ë³´ëŸ¬ê°€ê¸°](http://www.cpted.kr/?r=home&c=02/0205/020501)<br>
[ğŸ‘‰ ê°€ë¡œë“±ê³¼ ë²”ì£„ìœ¨ì˜ ê´€ê³„ ê¸°](https://www.yna.co.kr/view/AKR20200108078300004)
""")

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 3. ìœ„í—˜ë„ ë° ì‹œì„¤ë¬¼ í†µê³„ ë¹„êµ
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
st.subheader("3ï¸âƒ£ ì§„ì£¼ì‹œ í–‰ì •ë™ë³„ ìœ„í—˜ë„ ë° ë°©ë²” ì‹œì„¤ ë¹„êµ")

st.markdown("ìœ„í—˜ë“±ê¸‰ê³¼ CCTV ë° ê°€ë¡œë“± ì„¤ì¹˜ í˜„í™©ì„ í–‰ì •ë™ë³„ë¡œ ë¹„êµí•œ ê·¸ë˜í”„ì…ë‹ˆë‹¤.")

# ë°ì´í„° ë¡œë”©
grade_df = pd.read_excel("/workspaces/DS_TP/data/jinju_crime_grade.xlsx")
lamp_cctv_df = pd.read_excel("/workspaces/DS_TP/data/jinju_cctv_lamp.xlsx")
time_df=pd.read.excel("/workspaces/DS_TP/data/crime_time.xlsx")

# ë³‘í•©
merged_df = pd.merge(grade_df, lamp_cctv_df, on="í–‰ì •ë™", how="inner")

# ê·¸ë˜í”„
st.markdown("#### ğŸ”¢ ìœ„í—˜ë“±ê¸‰ AND CCTV & ê°€ë¡œë“± ìˆ˜")

#ì—¬ê¸°ì—ëŠ” ìœ„í—˜ë“±ê¸‰ê³¼ CCTV & ê°€ë¡œë“± ìˆ˜ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ê·¸ë˜í”„(2ì¤‘ yì¶•ìœ¼ë¡œ ì²œê°œ or ë§Œê°œ ë‹¨ìœ„ë¡œ ì¤„ì—¬ì„œ ë‚˜íƒ€ëƒ„)

st.markdown("ì‹œê°„ëŒ€ë³„ ë²”ì£„ ë°œìƒ ê±´ìˆ˜")

#ì—¬ê¸°ì—ëŠ” ì‹œê°„ëŒ€ë³„ ë²”ì£„ ë°œìƒ ê±´ìˆ˜ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ê·¸ë˜í”„

st.markdown("ìœ„ì˜ ê·¸ë˜í”„ë¡œ ì•Œ ìˆ˜ ìˆëŠ” ì‚¬ì‹¤ì„ ì ëŠ”ë‹¤.")

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 4. í–‰ì •êµ¬ì—­ + ì‹œì„¤ ìœ„ì¹˜ ì§€ë„
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
st.subheader("4ï¸âƒ£ ì§€ë„ ê¸°ë°˜ ì‹œê°í™”")

st.markdown("""
- ì•„ë˜ ì§€ë„ëŠ” **í–‰ì •ë™ ê²½ê³„ì™€ í•¨ê»˜ CCTV ë° ê°€ë¡œë“± ìœ„ì¹˜**ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.
- ì›í•˜ëŠ” í•„í„°ë¥¼ ì„ íƒí•´ì„œ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
""")

# ì§€ë„ í•„í„°
show_cctv = st.checkbox("CCTV ìœ„ì¹˜ ë³´ê¸°", value=False)
show_lamp = st.checkbox("ê°€ë¡œë“± ìœ„ì¹˜ ë³´ê¸°", value=False)

# ì§€ë„ ë°ì´í„° ì˜ˆì‹œ ë¡œë”© (ìœ„ë„/ê²½ë„ í¬í•¨ëœ CSV í•„ìš”)
cctv_data = pd.read_csv("/workspaces/DS_TP/data/jinju_cctv.xlsx", encoding="cp949")
lamp_data = pd.read_csv("/workspaces/DS_TP/data/jinju_lamp.xlsx", encoding="cp949")

map_center = [35.1802, 128.1076]  # ì§„ì£¼ì‹œ ì¤‘ì‹¬ ì¢Œí‘œ
m = folium.Map(location=map_center, zoom_start=13)

if show_cctv:
    for _, row in cctv_data.iterrows():
        folium.CircleMarker(
            location=[row['ìœ„ë„'], row['ê²½ë„']],
            radius=3,
            color='blue',
            fill=True,
            fill_opacity=0.7,
            tooltip="CCTV"
        ).add_to(m)

if show_lamp:
    for _, row in lamp_data.iterrows():
        folium.CircleMarker(
            location=[row['ìœ„ë„'], row['ê²½ë„']],
            radius=2,
            color='orange',
            fill=True,
            fill_opacity=0.6,
            tooltip="ê°€ë¡œë“±"
        ).add_to(m)

st_data = st_folium(m, width=1000, height=600)

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 5. í•´ê²°ë°©ì•ˆ ì œì‹œ
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
st.subheader("5ï¸âƒ£ í•´ê²° ë°©ì•ˆ ì œì‹œ")

st.markdown("""
- ğŸ“Œ **ë¶€ì¡±í•œ ì§€ì—­ì— CCTV ì¶”ê°€ ì„¤ì¹˜**
- ğŸ’¡ **ê°€ë¡œë“± ì„¤ì¹˜ ë° ë…¸í›„í™”ëœ ì‹œì„¤ ê°œì„ **
- â° **ê°€ë¡œë“± ìš´ì˜ì‹œê°„ ì—°ì¥ (ì‹¬ì•¼ ì‹œê°„ í¬í•¨)**
- â˜ï¸ **ì•ˆì‹¬ê·€ê°€ ì½œ ì„œë¹„ìŠ¤ í™œì„±í™”** 
""")
